#!/bin/bash

echo "üéÆ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–ª–ª–µ–∫—Ü–∏–∏ –∏–≥—Ä..."
echo "üíú –î–µ–ª–∞—é –≤—Å–µ —Å–∫—Ä–∏–ø—Ç—ã –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º–∏..."

# –î–∞–µ–º –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ–º .sh —Ñ–∞–π–ª–∞–º
chmod +x *.sh

echo ""
echo "üìù –°–æ–∑–¥–∞—é –∞–ª–∏–∞—Å 'games' –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞..."

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥ —Ñ–∞–π–ª–∞
detect_shell_config() {
    if [[ -n "$BASH_VERSION" ]]; then
        echo "$HOME/.bashrc"
    elif [[ -n "$ZSH_VERSION" ]]; then
        echo "$HOME/.zshrc"
    else
        echo "$HOME/.bashrc"
    fi
}

SHELL_CONFIG=$(detect_shell_config)

# –ü–æ–ª—É—á–∞–µ–º –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ —Å –∏–≥—Ä–∞–º–∏
GAMES_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# –î–ª—è Windows Git Bash –∏—Å–ø–æ–ª—å–∑—É–µ–º start –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
if [[ "$OSTYPE" == "msys" ]] || [[ "$OSTYPE" == "cygwin" ]]; then
    GAMES_ALIAS="alias games='cd \"$GAMES_DIR\" && bash games.sh'"
    echo "üîß –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ Windows —Å–∏—Å—Ç–µ–º–∞"
else
    # –î–ª—è Linux –∏—Å–ø–æ–ª—å–∑—É–µ–º gnome-terminal –∏–ª–∏ xterm
    GAMES_ALIAS="alias games='cd \"$GAMES_DIR\" && bash games.sh'"
fi

echo "üìç –ü—É—Ç—å –∫ –∏–≥—Ä–∞–º: $GAMES_DIR"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–≥–æ –∞–ª–∏–∞—Å–∞
if grep -q "alias games=" "$SHELL_CONFIG" 2>/dev/null; then
    echo "‚ö†Ô∏è  –ê–ª–∏–∞—Å 'games' —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –æ–±–Ω–æ–≤–ª—è—é..."
    # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∞–ª–∏–∞—Å
    sed -i.bak '/alias games=/d' "$SHELL_CONFIG"
fi

# –î–æ–±–∞–≤–ª—è–µ–º –∞–ª–∏–∞—Å –≤ –∫–æ–Ω—Ñ–∏–≥
echo "$GAMES_ALIAS" >> "$SHELL_CONFIG"

echo ""
echo "‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üöÄ –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–≥—Ä—ã –∫–æ–º–∞–Ω–¥–∞–º–∏:"
echo ""
echo "   games          - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (–Ω–æ–≤—ã–π –∞–ª–∏–∞—Å!)"
echo "   bash games.sh  - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"
echo ""
echo "üéØ –ò–≥—Ä—ã –±—É–¥—É—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –≤ –Ω–æ–≤—ã—Ö –æ–∫–Ω–∞—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞"
echo ""
echo "üîÑ –ï—Å–ª–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏ –ø–∞–ø–∫—É —Å –∏–≥—Ä–∞–º–∏, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   bash update.sh   - –û–±–Ω–æ–≤–∏—Ç –∞–ª–∏–∞—Å"
echo ""
echo "üîÅ –ß—Ç–æ–±—ã –∞–ª–∏–∞—Å –∑–∞—Ä–∞–±–æ—Ç–∞–ª, –≤—ã–ø–æ–ª–Ω–∏ –æ–¥–Ω—É –∏–∑ –∫–æ–º–∞–Ω–¥:"
echo "   source $SHELL_CONFIG"
echo "   –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Ç–µ—Ä–º–∏–Ω–∞–ª"
echo ""
echo "üìñ –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ README.md"
EOF
